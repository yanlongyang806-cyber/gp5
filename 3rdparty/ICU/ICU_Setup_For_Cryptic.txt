Compiling ICU 5.1 lib
By David Anderson

1) Get the source as described at: 
http://site.icu-project.org/repository
This probably requires setting up a SVN repository based on something in:
http://source.icu-project.org/repos/icu/icu/tags/
like:
http://source.icu-project.org/repos/icu/icu/tags/release-51-rc
I put the files in "C:\ICU", until I could get it compiling. When that all works, you'll need to move the .h files to your project's "C:\<ProjectSrc>\3rdParty\ICU" and .lib files to "C:\<ProjectSrc>\3rdParty\bin".

2) Customize the data set generation (Skip this step for now):
http://apps.icu-project.org/datacustom/
Allows you to build a set of the data files that will be much smaller than the 16MB or so needed for full ICU. So far, we only need the Normalization data, which is in the "Base Data". Everything else has been stripped out.
IMPORTANT: Make sure the version generated by this tool matches the version of ICU you downloaded above. 
Download the resulting "icudtXXx.dat" file (the current version is "icudt51l.dat"), and extract it to:
"C:\ICU\source\data\in"
ICU uses the data in the "data\in" folder during icupkg, but we're not running that yet.
Copy this .dat file to "C:\src\3rdparty\ICU\include\data\".
You'll #include this .dat file to fill in an array that will be passed to udata_setCommonData() in our project.

3) Update the .vcxproj settings to .lib:
Open the ICU solution from "C:\ICU\source\allinone\allinone.sln".
IMPORTANT: Make sure you update the Win32 AND x64 builds!

We really only care about the "stubdata" and "common" projects. "stubdata" takes all the localization data (from step #2)and (with the help of "common") make a icudt52.lib and icuuc52d.lib.
Make sure the TargetName and Output Directory is set correctly, on the Project Properties -> General page.
Common:
OutDir = .\..\..\lib\
TargetName = icuuc51d
TargetName(64) = icuuc51d_64
stubdata:
OutDir = .\..\..\lib\
TargetName = icudt51
TargetName(64) = icudt51_64

For both projects, change the settings so they match our solutions.
"General -> Configuration Type": from "Dynamic Library (.dll)" to "Static library (.lib)"
"C/C++ -> Code Generation -> Run-time Library": from "Multi-threaded DLL Debug (/MDd)" to "Multi-threaded Debug (/MTd)"
"C/C++ -> General -> Debug Information Format": from "Program Database (/Zi)" to "C7 Compatible (/Z7)"

For the x64 build, update the Target Machine /MACHINE value to something 64-bit:
"Librarian -> General -> Target Machine": from blank to "MachineX64 (/MACHINE:X64)"

I was sick of the #defines not working like I expected, so I added this line to utypes.h around line 291, just before the big #ifdef for the U_*_API defines that switch around the dllexport modes:
#define U_STATIC_IMPLEMENTATION

4) Build the "Common" project:
Make sure you build for x64 and Win32 configurations.
This will create a icudt51_64.lib, icuuc51d_64.lib, icudt51.lib and icuuc51d.lib in "C:\ICU\lib".
Copy these to "C:\src\3rdparty\bin"
Since this project is built with "Program Database for Edit and Continue (/ZI)", the .pdb info is embedded in the .lib files, so no separate .pdb to copy around.

5) Copy the current source files.
Copy the whole "C:\ICU\" directory structure to "C:\src\3rdparty\ICU\".

6) Make sure our solution builds:
Build any of our solutions to make sure the new libs work.

7) Check it all in:
Check in "C:\src\3rdparty\bin" and "C:\src\3rdparty\ICU".


Defines:
U_UTF8_IMPL
U_STATIC_IMPLEMENTATION

Build Dependencies:
stubdata
common
<everything else>
